<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Gym Juanpe</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body{ background:#f6f7fb; }
    .topbar{ background:#111827; color:#fff; }
    .hero{
      background: linear-gradient(135deg,#0b1220,#0f1b3a);
      color:#fff; border-radius:18px;
      padding:40px; margin-top:20px;
    }
    .card{ border:0; border-radius:16px; box-shadow:0 10px 26px rgba(17,24,39,.08); }
    .muted{ color:#6b7280; }
    .gym-card img{ border-top-left-radius:16px; border-top-right-radius:16px; height:160px; object-fit:cover; }
  </style>
</head>

<body>
  <div class="topbar py-3">
    <div class="container d-flex justify-content-between align-items-center">
      <div class="fw-bold">üèãÔ∏è Gym Juanpe</div>
      <div class="text-white-50">Demo Web (sin login)</div>
    </div>
  </div>

  <div class="container">

    <div class="hero">
      <h1 class="fw-bold mb-2">¬øD√≥nde quieres entrenar?</h1>
      <p class="text-white-50 mb-4">Explora planes, clases y disponibilidad (demo consumiendo API).</p>

      <div class="row g-2">
        <div class="col-md-9">
          <input id="search" class="form-control form-control-lg" placeholder="Busca por clase, entrenador o horario...">
        </div>
        <div class="col-md-3">
          <button class="btn btn-primary btn-lg w-100" onclick="loadAll()">Buscar</button>
        </div>
      </div>

      <div class="small mt-3 text-white-50">
        Estado API: <span id="apiStatus">probando...</span>
      </div>
    </div>

    <div class="row g-4 mt-3">

      <div class="col-lg-4">
        <div class="card p-4">
          <h5 class="fw-bold mb-1">Planes</h5>
          <div class="muted mb-3">Promos y membres√≠as disponibles.</div>
          <div id="plans"></div>
        </div>
      </div>

      <div class="col-lg-8">
        <div class="card p-4">
          <h5 class="fw-bold mb-1">Clases y entrenadores</h5>
          <div class="muted mb-3">Horarios, cupos y reservas (demo).</div>
          <div class="row g-3" id="classes"></div>
        </div>
      </div>

    </div>

    <div class="text-center my-5 muted">¬© 2025 ‚Äì Gym Juanpe | Spring Boot + API</div>
  </div>

<script>
  async function getJson(url){
    const res = await fetch(url);
    if(!res.ok) throw new Error("HTTP "+res.status);
    return await res.json();
  }

  async function checkHealth(){
    try{
      const h = await getJson("/api/public/health");
      document.getElementById("apiStatus").textContent = "OK ‚úÖ ("+h.service+")";
    }catch(e){
      document.getElementById("apiStatus").textContent = "ERROR ‚ùå (revisa tu backend)";
    }
  }

  function renderPlans(plans){
    const el = document.getElementById("plans");
    el.innerHTML = plans.map(p => `
      <div class="border rounded-3 p-3 mb-2">
        <div class="d-flex justify-content-between">
          <div class="fw-bold">${p.name}</div>
          <div class="fw-bold">S/ ${p.price}</div>
        </div>
        <div class="muted">Duraci√≥n: ${p.durationDays} d√≠as</div>
        <button class="btn btn-outline-primary btn-sm mt-2 w-100" disabled>Inscribirse (demo)</button>
      </div>
    `).join("");
  }

  function renderClasses(classes){
    const q = document.getElementById("search").value.toLowerCase().trim();

    const filtered = classes.filter(c =>
      !q ||
      (c.title+" "+c.trainer+" "+c.time).toLowerCase().includes(q)
    );

    const el = document.getElementById("classes");

    if(filtered.length === 0){
      el.innerHTML = `<div class="text-muted">No se encontraron clases con ese filtro.</div>`;
      return;
    }

    el.innerHTML = filtered.map(c => `
      <div class="col-md-6">
        <div class="card gym-card">
          <img src="https://images.unsplash.com/photo-1517836357463-d25dfeac3438?auto=format&fit=crop&w=900&q=60" alt="gym">
          <div class="p-3">
            <div class="fw-bold">${c.title}</div>
            <div class="muted">Trainer: ${c.trainer}</div>
            <div class="muted">Hora: ${c.time}</div>
            <div class="muted">Cupos: ${c.reserved}/${c.capacity}</div>
            <button class="btn btn-primary btn-sm mt-2 w-100" disabled>Reservar (demo)</button>
          </div>
        </div>
      </div>
    `).join("");
  }

  async function loadAll(){
    try{
      const [plans, classes] = await Promise.all([
        getJson("/api/public/plans"),
        getJson("/api/public/classes"),
      ]);
      renderPlans(plans);
      renderClasses(classes);
    }catch(e){
      alert("No se pudo cargar datos. Revisa que tu API est√© corriendo.");
    }
  }

  checkHealth();
  loadAll();
</script>

</body>
</html>
